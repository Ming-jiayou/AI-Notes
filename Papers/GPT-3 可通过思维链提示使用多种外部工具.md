MultiTool-CoT: GPT-3 Can Use Multiple External Tools with Chain of
Thought Prompting

MultiTool-CoT：GPT-3 可通过思维链提示使用多个外部工具  
稲场達郎¹、清丸宏和¹、程飞¹、黑桥Sadao¹,²  
1 日本京都大学  
2 日本国立信息学研究所  
{inaba, kiyomaru, feicheng, kuro}@nlp.ist.i.kyoto-u.ac.jp

摘要  

大型语言模型（LLMs）在各种推理任务中已展现出卓越的性能。为进一步提升性能，我们提出了MultiTool-CoT这一新颖框架，该框架在推理过程中利用思维链（CoT）提示，集成多个外部工具，例如计算器和知识检索器。我们将MultiTool-CoT应用于NumGLUE的Task 2数据集，该数据集要求同时进行数值推理和领域特定知识的运用。实验结果表明，我们的方法显著优于强劲的基线模型，并达到了最先进的性能水平。

1 引言  

推理是指从已知事实推断未知事实的逻辑过程。解决推理问题需要语言理解、现实世界知识、算术计算和符号处理。提升人工智能的推理能力长期以来一直是一个挑战，至今仍是活跃的研究课题（Gordon 等，2012；Sap 等，2020）。

最近，大型语言模型（LLMs）在各种推理任务上取得了惊人表现（Brown 等，2020；Lewkowycz 等，2022；Zhang 等，2022；Chowdhery 等，2022）。然而，LLMs 所学习的现实世界知识量仍受模型参数规模和训练数据的限制。这一问题在稀疏的领域特定知识情况下可能更为严重。此外，LLMs 基于连续的词元表示进行计算，无法保证算术运算的准确性。

为了解决这些问题，以往的研究提出通过引入外部工具（如网络浏览器或计算器）来增强大语言模型（LLMs）的能力（Nakano 等，2021；Cobbe 等，2021；Yao 等，2022）。这一过程通过在LLM推理期间调用外部工具，并将结果注入推理流程中来实现。然而，以往的研究主要关注利用单一外部工具解决单一问题，尚未兼顾同时处理多种不同类型的问题。

本文提出了MultiTool-CoT，一种交互式框架，允许大语言模型在推理过程中使用多个外部工具。图1提供了整体概览。在MultiTool-CoT中，大语言模型通过生成包含调用外部工具的触发指令的推理过程来解决推理问题。我们基于少样本学习（Wei等，2022）的思维链（CoT）提示，使大语言模型学会在适当的推理步骤中调用多个外部工具。

作为概念验证，我们将MultiTool-CoT应用于NumGLUE（Mishra等，2022）的Task 2数据集，该数据集要求同时具备数值推理和领域专业知识。实验表明，MultiTool-CoT显著优于强大的基线方法，并达到了最先进的性能。

2 相关工作  

大型语言模型（LLMs）可以通过提示来完成各种任务（Liu 等，2022）。对于推理任务，思维链（CoT）提示（Wei 等，2022；Kojima 等，2022）因其有效性而广为人知，它通过引导大型语言模型生成中间推理步骤来得出答案。越来越多的研究致力于利用外部工具来提升大语言模型的推理能力。Cobbe 等人（2021）通过微调大语言模型，使其能够生成带有工具调用触发符的数学公式，从而调用计算器来处理推理过程中出现的数学运算。Nakano 等人（2021）则允许大语言模型使用通过微调大语言模型（LLMs）生成用于操作浏览器的动作代码来实现网页浏览器。以往的研究集中于LLMs的单一问题，例如算术计算容易出错或现实世界知识不完整，并通过微调LLMs使其能够调用单一外部工具来解决这些问题。相比之下，本研究通过允许LLMs使用多个外部工具，同时应对多个问题。此外，本研究提出了一种基于少样本学习的框架（Brown等，2020），该框架无需进行微调即可实现上述功能。

一项最近的研究（Yao 等，2022 年）提出了一种基于少量样本学习的方法，通过调用维基百科 API 来执行知识密集型推理任务。然而，这项研究并未探讨使用多个外部工具的有效性。名为 LangChain2 的 Python 库基于 Yao 等人（2022 年）的研究，实现了一个框架，使大型语言模型能够使用多个外部工具，这与我们的方法类似。但截至本稿件提交时，尚未在任何基准数据集上对其有效性进行评估。

3 方法

我们提出了 MultiTool-CoT，这是一种交互式框架，允许大语言模型（LLMs）在推理过程中使用多个外部工具。图1展示了该框架的总体流程。

MultiTool-CoT 基于少样本学习的思维链（Chain-of-Thought, CoT）提示策略（Wei 等，2022）。我们的提示由三部分组成：说明可用的外部工具、若干展示推理过程的问答示例（few-shot examples），以及待解决的问题。我们手动标注了这些少样本示例中的推理过程，其中通过特定格式标记工具触发词及其对应输入数据。在本研究中，我们使用字符串 <<外部工具名称>> 作为工具触发词。例如，若使用计算器作为外部工具，则在输入公式如 “2 × 62” 之后标注工具触发词 <<Calculator>>。

在推理过程中，GPT-3 遵循提示生成包含工具触发词的推理过程。一旦生成了工具触发词，我们便暂停文本生成，提取外部工具的名称及其输入参数，调用相应的外部工具执行计算，并将结果追加到推理过程的末尾。随后重新启动文本生成。

若因某种原因（如生成了无效的工具输入）无法执行外部工具，我们将回退至 GPT-3，由其直接生成该工具的输出结果。

我们观察到，最终答案几乎总是出现在推理过程的最后一句中。因此，我们额外采用了一个基于少样本学习的 GPT-3 过程，通过提示若干“句子-答案”对应对，将推理过程的最后一句映射为最终答案值。

5 结论  

我们提出了MultiTool-CoT框架，该框架使大语言模型在推理过程中能够使用多种外部工具，例如知识检索器和计算器。我们将MultiTool-CoT应用于需要化学知识的数值推理任务，并验证了其有效性。该框架具有通用性，只需更改和扩展外部工具，即可应用于各种任务。我们计划在未来验证该方法在其他任务中的有效性。
